<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>EUResearchHub</title>
        <link rel="stylesheet" href="../static/style.css">
        <link rel="stylesheet" href="../static/style_profile.css">
        <meta name="csrf-token" content="{{ csrf_token() }}">

        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link rel="stylesheet" href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css'>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap">
        <link rel="stylesheet" href="../static/style_upload.css">

        <link rel="stylesheet" type="text/css" href="../static/css/util.css">

        <link rel="stylesheet" type="text/css" href="../static/css/main.css">

    </head>
    <body>
        <div class="app-container">
            <div class="app-header">
                <div class="app-header-left">
                    <span class="app-icon"></span>
                    <p class="app-name">EUResearchHub</p>
                </div>
                <div class="app-header-right">
                    <button class="notification-btn" onclick="location.href='{{ url_for('auth.logout') }}'">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
                            <defs/>
                            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/>
                        </svg>
                    </button>
                    <button class="profile-btn">

                    <img src="../static/uploads/profile_images/{{ profile_picture }}" />
                    <span> {{ name }} {{ surname }} </span>
                    </button>
                </div>
                <button class="messages-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                    </svg>
                </button>
            </div>
            <div class="app-content">
                <div class="app-sidebar">
                </div>

                <!-- COLONNA SINISTRA -->

                <div class="projects-section">
                    <div class="projects-section-header">
                        <p style="color:#666666;">{{ project.title }}</p>

                    </div>
                    <div class="projects-section-line">
                        <div class="projects-status">
                            <div class="item-status">
                                <span class="status-type">{{ project.description }}</span>
                            </div>
                        </div>

                    </div>
                    <div class="project-boxes jsListView">
                        {% if documents %}
                            {% for document in documents %}
                                <div class="project-box-wrapper">
                                    <div class="project-box" style="background-color: rgba(114,157,172,0.09)">

                                        <div class="project-box-content-header">
                                            <p class="box-content-header">{{ document.nome }}</p>
                                            <p class="box-content-subheader">{{ document.descrizione }}</p>
                                        </div>
                                        <div class="box-progress-wrapper">

                                        </div>
                                        <div class="project-box-footer">
                                            <div class="days-left" style="color: #729DAC;">
                                                <a href="{{ url_for('static', filename= 'uploads/projects/' + document.finelename + '.pdf') }}" download>Download</a>
                                            </div>
                                            <br>
                                            {% if session['user_type'] == 'researcher' %}
                                                {% if document.ev_rep %}
                                                    <div class="days-left" style="color: #729DAC;">
                                                        <a href="{{ url_for('static', filename= 'uploads/projects/' + document.ev_rep + '.pdf') }}"
                                                           download
                                                        >ev.report</a>
                                                    </div>
                                                {% endif %}
                                            {% else %}

                                                <div class="days-left" style="color: #729DAC;">
                                                    {% if document.ev_rep %}
                                                        <a href="{{ url_for('static', filename= 'uploads/projects/' + document.ev_rep + '.pdf') }}"
                                                           download
                                                        >ev.report</a>
                                                    {% else %}
                                                        <button onClick="toggleUpload3()">Upload ev.report</button>
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}


                    {% if session['user_type'] == 'researcher' %}
                        <div class="new-document-box-wrapper">
                            <div class="new-document-box">
                                <div class="button-hold">
                                    <button id="openModalButton" class="plus-button"></button>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    </div>
                </div>

                <!-- COLONNA DESTRA -->

                <div class="alignment">

                    <div class="messages-section">
                        <button class="messages-close">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="15" y1="9" x2="9" y2="15" />
                                <line x1="9" y1="9" x2="15" y2="15" />
                            </svg>
                        </button>
                        <div class="projects-section-header">
                            <p style="color:#666666;">Messages</p>
                        </div>
                        <div class="messages">
                            {% for message in messages %}
                            <div class="message-box">
        <img src="../static/uploads/profile_images/{% if researchers[loop.index0] %}{{ researchers[loop.index0].profile_picture }}{% elif evaluators[loop.index0] %}default.jpg{% endif %}" alt="profile image">


                                <div class="message-content">
                                    <div class="message-header">
                                        <div class="name" style="color:#666666;"> {% if researchers[loop.index0] %}
                        {{ researchers[loop.index0].name }} {{ researchers[loop.index0].surname }}
                    {% elif evaluators[loop.index0] %}
                        Unknown
                    {% endif %}
                    </div>
                                    </div>
                                    <p class="message-line">
                {{ message.text }}
                                    </p>
                                    <p class="message-line time">
                {{ message.date.strftime('%Y-%m-%d %H:%M:%S') }}
                                    </p>
                                </div>
                            </div>

    {% endfor %}


                        </div>




                    </div>


<form action="" class="message-label hide-submit message-sender" method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input class="message-holder" type="text" name="message" placeholder="Type anything..." required>
            <button type="submit" class="submit-button">
                <svg style="height:35px" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#666666">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M10 14L13 21L20 4L3 11L6.5 12.5" stroke="#666666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    </g>
                </svg>
            </button>
</form>



                    <div class="versions-section">
                        <div class="projects-section-header">
                            <p style="color:#666666;">Versions of: [name] </p>
                            <div class="button-hold-versions">
                                <button id="openModalButton2" class="plus-button-versions"></button>
                            </div>
                        </div>
                        <div class="messages">

                            <div class="message-box">
                                <div class="message-content">
                                    <div class="message-header">
                                        <div class="name" style="color:#666666;">1. [file_path]</div>

                                    </div>
                                    <p class="message-line">
                                        [description changes made]
                                    </p>
                                    <p class="message-line time">
                                        [datetime]
                                    </p>
                                </div>
                            </div>




                    </div>
                </div>
            </div>
        </div>

        <div id="modalContainer" class="modal-container">
            <form action="/add_document/{{ session['project_id'] }}" method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div id="uploadArea" class="upload-area">
                    <!-- Header -->
                    <div class="upload-area__header">
                        <h1 class="upload-area__title">  Upload your file </h1>
                        <p class="upload-area__paragraph">
                            File should be a document or image
                            <strong class="upload-area__tooltip">
                                <span class="upload-area__tooltip-data"></span> <!-- Data Will be Comes From Js -->
                            </strong>
                        </p>
                    </div>
                    <!-- End Header -->

                    <!-- Drop Zone -->
                    <div id="dropZoon" class="upload-area__drop-zoon drop-zoon">
                        <span class="drop-zoon__icon">
                          <i class='bx bxs-file-image'></i>
                        </span>
                        <p class="drop-zoon__paragraph">Drop your file here or Click to browse</p>
                        <span id="loadingText" class="drop-zoon__loading-text">Please Wait</span>
                        <img src="" alt="Preview Image" id="previewImage" class="drop-zoon__preview-image" draggable="false">
                        <input required type="file" id="fileInput" class="drop-zoon__file-input" accept="application/pdf" name="document">
                    </div>
                    <!-- End Drop Zone -->

                    <!-- File Details -->
                    <div id="fileDetails" class="upload-area__file-details file-details">
                        <h3 class="file-details__title">Uploaded File</h3>

                        <div id="uploadedFile" class="uploaded-file">
                            <div class="uploaded-file__icon-container">
                                <i class='bx bxs-file-blank uploaded-file__icon'></i>
                                <span class="uploaded-file__icon-text"></span> <!-- Data Will be Comes From Js -->
                            </div>

                            <div id="uploadedFileInfo" class="uploaded-file__info">
                                <span class="uploaded-file__name">Proejct 1</span>
                                <span class="uploaded-file__counter">0%</span>
                            </div>

                        </div>
                    </div>
                    <div class="selectDT">
                        <label class="doctypelabel">Seleziona il tipo di documento</label>
                        <select name="docType" id="selectDocType">

                        </select>
                    </div>
                    <!-- End File Details -->
                    <div class="container-login100-form-btn">

                        <button class="login100-form-btn upload-button" type="submit">
                            <strong>Upload</strong>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <div id="modalContainer2" class="modal-container">
            <div id="uploadArea2" class="upload-area">
                <!-- Header -->
                <div class="upload-area__header">
                    <h1 class="upload-area__title">  Upload your file </h1>
                    <p class="upload-area__paragraph">
                        File should be a document or image
                        <strong class="upload-area__tooltip">
                            <span class="upload-area__tooltip-data2"></span> <!-- Data Will be Comes From Js -->
                        </strong>
                    </p>
                </div>
                <!-- End Header -->

                <!-- Drop Zone -->
                <div id="dropZoon2" class="upload-area__drop-zoon drop-zoon">
                    <span class="drop-zoon__icon">
                      <i class='bx bxs-file-image'></i>
                    </span>
                    <p class="drop-zoon__paragraph">Drop your file here or Click to browse</p>
                    <span id="loadingText2" class="drop-zoon__loading-text">Please Wait</span>
                    <img src="" alt="Preview Image" id="previewImage2" class="drop-zoon__preview-image" draggable="false">
                    <input type="file" id="fileInput2" class="drop-zoon__file-input" accept="image/pdf">
                </div>
                <!-- End Drop Zone -->

                <!-- File Details -->
                <div id="fileDetails3" class="upload-area__file-details file-details">
                    <h3 class="file-details__title">Uploaded File</h3>

                    <div id="uploadedFile2" class="uploaded-file">
                        <div class="uploaded-file__icon-container">
                            <i class='bx bxs-file-blank uploaded-file__icon'></i>
                            <span class="uploaded-file__icon-text2"></span> <!-- Data Will be Comes From Js -->
                        </div>

                        <div id="uploadedFileInfo2" class="uploaded-file__info">
                            <span class="uploaded-file__name2">Proejct 1</span>
                            <span class="uploaded-file__counter2">0%</span>
                        </div>
                    </div>
                </div>

                <div id="uploadedDescription-container2" class="uploadedDescription-container">
                    <div id="uploadedDescription2" class="uploaded-description">
                        <form  class="login100-form-description validate-form" method="post">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input class="input-description" type="text" required name="description" placeholder="Inser your description here">

                        </form>
                    </div>
                </div>

                <div class="container-login100-form-btn">

                    <button class="login100-form-btn upload-button" type="submit">
                        <strong>Upload</strong>
                    </button>
                </div>
                <!-- End File Details -->
            </div>
            <!-- End Upload Area -->
        </div>
        <div id="modalContainer3" class="modal-container">
            <div id="uploadArea3" class="upload-area">
                <!-- Header -->
                <div class="upload-area__header">
                    <h1 class="upload-area__title">  Upload your file </h1>
                    <p class="upload-area__paragraph">
                        File should be a document or image
                        <strong class="upload-area__tooltip">
                            <span class="upload-area__tooltip-data2"></span> <!-- Data Will be Comes From Js -->
                        </strong>
                    </p>
                </div>
                <!-- End Header -->

                <!-- Drop Zone -->
                <div id="dropZoon3" class="upload-area__drop-zoon drop-zoon">
                    <span class="drop-zoon__icon">
                      <i class='bx bxs-file-image'></i>
                    </span>
                    <p class="drop-zoon__paragraph">Drop your file here or Click to browse</p>
                    <span id="loadingText3" class="drop-zoon__loading-text">Please Wait</span>
                    <img src="" alt="Preview Image" id="previewImage3" class="drop-zoon__preview-image" draggable="false">
                    <input type="file" id="fileInput3" class="drop-zoon__file-input" accept="image/pdf">
                </div>
                <!-- End Drop Zone -->

                <!-- File Details -->
                <div id="fileDetails3" class="upload-area__file-details file-details">
                    <h3 class="file-details__title">Uploaded File</h3>

                    <div id="uploadedFile3" class="uploaded-file">
                        <div class="uploaded-file__icon-container">
                            <i class='bx bxs-file-blank uploaded-file__icon'></i>
                            <span class="uploaded-file__icon-text2"></span> <!-- Data Will be Comes From Js -->
                        </div>

                        <div id="uploadedFileInfo2" class="uploaded-file__info">
                            <span class="uploaded-file__name2">Proejct 1</span>
                            <span class="uploaded-file__counter2">0%</span>
                        </div>
                    </div>
                </div>

                <div id="uploadedDescription-container3" class="uploadedDescription-container">
                    <div id="uploadedDescription3" class="uploaded-description">
                        <form  class="login100-form-description validate-form" method="post">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input class="input-description" type="text" required name="description" placeholder="Inser your description here">

                        </form>
                    </div>
                </div>

                <div class="container-login100-form-btn">

                    <button class="login100-form-btn upload-button" type="submit">
                        <strong>Upload</strong>
                    </button>
                </div>
                <!-- End File Details -->
            </div>
            <!-- End Upload Area -->
        </div>
        <!-- partial -->
        <script src="../static/vendor/jquery/jquery-3.2.1.min.js"></script>
        <script src="../static/functions.js"></script>

        <script>
            const openModalButton = document.getElementById('openModalButton');
            const openModalButton2 = document.getElementById('openModalButton2');
            const openModalButton3 = $('#openModalButton3')
            const modalContainer = document.getElementById('modalContainer');
            const modalContainer2 = document.getElementById('modalContainer2');
            const modalContainer3 = document.getElementById('modalContainer3');

            openModalButton.addEventListener('click', function() {
                $.ajax({
                    url: '/api/get_doc_types',
                    type: 'POST',
                    datatype: 'json',
                    beforeSend: (xhr) => {
                        xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
                    },
                    success: (data) => {
                        $('#selectDocType').empty()
                        data.forEach(item => {
                            $('#selectDocType').append(`<option class="inputdoctype" value="${item.id}">${item.name}</option>`)
                        })
                    }
                })
                modalContainer.style.display = 'block';
            });

            openModalButton2.addEventListener('click', function() {
                modalContainer2.style.display = 'block';
            });

            // Hide the modal when the user clicks outside of it
            window.addEventListener('click', function(event) {
                if (event.target === modalContainer) {
                    modalContainer.style.display = 'none';
                }
            });

            window.addEventListener('click', function(event) {
                if (event.target === modalContainer2) {
                    modalContainer2.style.display = 'none';
                }
            });

        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.8.335/pdf.min.js"></script>

    </body>
</html>